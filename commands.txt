## Commands
This section lists command(s) run by mavis workflow

* Running mavis

MAVIS annotates structural variants for WG and WT experiments

Configuring is done using custom python code which produces a configuration script ran at the next step

```
   See generateConfigScript task in mavis.wdl 

```

Run Configure scripts:

```
    export MAVIS_REFERENCE_GENOME=REF_GENOME
    export MAVIS_ANNOTATIONS=ANNOTATIONS
    export MAVIS_MASKING=MASKING
    export MAVIS_DGV_ANNOTATION=DVG_ANNOTATIONS
    export MAVIS_ALIGNER_REFERENCE=ALIGN_REFERENCE
    export MAVIS_TEMPLATE_METADATA=TEMPLATE_METADATA
    chmod +x CONFIG_SCRIPT
    CONFIG_SCRIPT
```

Setup mavis:

```
    set -euo pipefail
    unset LD_LIBRARY_PATH
    unset LD_LIBRARY_PATH_modshare
    export MAVIS_ALIGNER='MAVIS_ALIGNER'
    export MAVIS_DRAW_FUSIONS_ONLY=MAVIS_DRAW_FUSION_ONLY
    export MAVIS_MAX_FILES=MAVIS_MAX_FILE
    export DRAW_NON_SYNONYMOUS_CDNA_ONLY=DRAW_NONSYNOMOUS_CDNA_ONLY
    export min_clusters_per_file=MIN_CLUSTER_PER_FILE
    export MAVIS_UNINFORMATIVE_FILTER=MAVIS_UNINFORMATIVE_FILTER
    mavis setup CONFIG_FILE -o .
    # Try to get batch ID from the "build.cfg" file generated by setup
    grep MS_batch build.cfg | grep -v \] | sed s/.*-// | tail -n 1 | sed s/\n// > BATCH_NAME || 
      echo "unknown_batch" > BATCH_NAME
```

Post-process and launch bash scripts (used to modify multiple scripts)

```
    set -euo pipefail
    sed -i "s|^[[:space:]]*cd .*||g" SCRIPT # do not change the working directory
    sed -i "s|^[[:space:]]*echo .*||g" SCRIPT # do not echo start/finish times
    sed -i "s|--inputs .*|--inputs IN_FILES \\\\|g" SCRIPT
    sed -i "s|--output .*|--output .|g" SCRIPT
    chmod +x SCRIPT

    SCRIPT
```

Package the results into a .zip archive

```
    set -euo pipefail
    mkdir OUT_PREFIX
    cp -t OUT_PREFIX INPUT_FILES
    zip -qr OUT_PREFIX.zip OUT_PREFIX

```

